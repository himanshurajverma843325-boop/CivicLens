<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authority Dashboard | CivicLens AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --primary: #2563eb; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; margin: 0; }
        
        .nav { background: #0f172a; color: white; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; }
        .container { padding: 40px; max-width: 1200px; margin: 0 auto; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 5px solid var(--primary); }
        
        .report-table { width: 100%; border-collapse: collapse; background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .report-table th { background: #f1f5f9; padding: 15px; text-align: left; font-weight: 800; color: #475569; }
        .report-table td { padding: 15px; border-top: 1px solid #f1f5f9; vertical-align: middle; }
        
        .issue-img { width: 80px; height: 60px; object-fit: cover; border-radius: 8px; cursor: pointer; }
        .badge { padding: 6px 12px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; }
        .badge-pending { background: #fef3c7; color: #d97706; }
        .badge-resolved { background: #dcfce7; color: #16a34a; }
        
        .btn-resolve { 
            background: var(--success); color: white; text-decoration: none; 
            padding: 8px 16px; border-radius: 8px; font-size: 0.85rem; font-weight: 700;
            transition: 0.3s; display: inline-block;
        }
        .btn-resolve:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2); }
        
        .map-link { color: var(--primary); text-decoration: none; font-weight: 700; font-size: 0.85rem; }
    </style>
</head>
<body>

    <nav class="nav">
        <h2 style="margin:0;"><i class="fas fa-shield-alt"></i> Authority Portal</h2>
        <div>
            <span style="margin-right: 20px;">Welcome, <b>{{ session['user_name'] }}</b></span>
            <a href="{{ url_for('logout') }}" style="color:white; text-decoration:none;"><i class="fas fa-sign-out-alt"></i></a>
        </div>
    </nav>

    <div class="container">
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div style="background: var(--success); color: white; padding: 15px; border-radius: 12px; margin-bottom: 25px; font-weight: 700;">
                <i class="fas fa-check-circle"></i> {{ messages[0] }}
            </div>
          {% endif %}
        {% endwith %}

        <div class="stats-grid">
            <div class="stat-card">
                <small style="color:#64748b;">Total Reports</small>
                <h2 style="margin:5px 0;">{{ reports|length }}</h2>
            </div>
        </div>

        <table class="report-table">
            <thead>
                <tr>
                    <th>Issue</th>
                    <th>Reported By</th>
                    <th>Category & AI Description</th>
                    <th>Location</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td>
                        <a href="{{ url_for('static', filename='uploads/' + report.image_path) }}" target="_blank">
                            <img src="{{ url_for('static', filename='uploads/' + report.image_path) }}" class="issue-img">
                        </a>
                    </td>
                    <td>
                        <div style="font-weight:700;">{{ report.user_name or 'Anonymous' }}</div>
                        <small style="color:#64748b;">{{ report.timestamp }}</small>
                    </td>
                    <td>
                        <div style="font-weight:800; color: #1e293b;">{{ report.issue_type }}</div>
                        <small style="color:#64748b; font-style: italic;">{{ report.ai_description }}</small>
                    </td>
                    <td>
                        <div style="font-size: 0.8rem; max-width: 200px; margin-bottom: 5px;">{{ report.address }}</div>
                        <a href="https://www.google.com/maps?q={{ report.lat }},{{ report.lon }}" target="_blank" class="map-link">
                            <i class="fas fa-external-link-alt"></i> View on Map
                        </a>
                    </td>
                    <td>
                        <span class="badge {% if report.status == 'Pending' %}badge-pending{% else %}badge-resolved{% endif %}">
                            {{ report.status }}
                        </span>
                    </td>
                    <td>
                        {% if report.status == 'Pending' %}
                            <a href="{{ url_for('resolve_issue', id=report.id) }}" class="btn-resolve">
                                <i class="fas fa-check"></i> Resolve
                            </a>
                        {% else %}
                            <i class="fas fa-check-double" style="color: var(--success);"></i>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align:center; padding: 40px; color: #64748b;">No reports found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</body>
</html>